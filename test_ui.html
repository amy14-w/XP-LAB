<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassLens API Tester</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; margin-bottom: 30px; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .response pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ClassLens API Tester</h1>
        
        <div class="tabs">
            <button class="tab" onclick="switchTab('auth')">Auth</button>
            <button class="tab active" onclick="switchTab('professor')">Professor</button>
            <button class="tab" onclick="switchTab('student')">Student</button>
            <button class="tab" onclick="switchTab('questions')">Questions</button>
        </div>

        <!-- Auth Tab -->
        <div id="auth" class="tab-content">
            <h2>Authentication</h2>
            
            <h3>Register</h3>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="regEmail" placeholder="user@example.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="regPassword" placeholder="password">
            </div>
            <div class="form-group">
                <label>Role:</label>
                <select id="regRole">
                    <option value="professor">Professor</option>
                    <option value="student">Student</option>
                </select>
            </div>
            <button onclick="register()">Register</button>

            <h3>Login</h3>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" placeholder="user@example.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" placeholder="password">
            </div>
            <button onclick="login()">Login</button>

            <div id="authResponse" class="response" style="display:none;"></div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 4px;">
                <strong>üí° After registering/logging in:</strong>
                <p>Copy the <code>user_id</code> from the response and use it in the Professor/Student tabs.</p>
            </div>
        </div>

        <!-- Professor Tab -->
        <div id="professor" class="tab-content active">
            <h2>Professor Actions</h2>
            
            <div class="form-group">
                <label>Professor ID:</label>
                <input type="text" id="profId" placeholder="Enter professor ID">
            </div>

            <h3>Create Class</h3>
            <div class="form-group">
                <label>Class Name:</label>
                <input type="text" id="className" placeholder="e.g., CS 101">
            </div>
            <button onclick="createClass()">Create Class</button>

            <h3>Create Lecture</h3>
            <div class="form-group">
                <label>Class ID:</label>
                <input type="text" id="createLectureClassId" placeholder="Enter class ID">
            </div>
            <button onclick="createLecture()">Create Lecture</button>
            <div id="lectureIdDisplay" style="margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 4px; display: none;">
                <strong>Lecture ID:</strong> <span id="createdLectureId"></span>
            </div>

            <h3>Start Lecture</h3>
            <div class="form-group">
                <label>Lecture ID:</label>
                <input type="text" id="lectureId" placeholder="Enter lecture ID">
            </div>
            <button onclick="startLecture()">Start Lecture</button>
            <button onclick="endLecture()">End Lecture</button>

            <h3>Log Participation</h3>
            <div class="form-group">
                <label>Student ID:</label>
                <input type="text" id="participationStudentId" placeholder="Enter student ID">
            </div>
            <div class="form-group">
                <label>Lecture ID:</label>
                <input type="text" id="participationLectureId" placeholder="Enter lecture ID">
            </div>
            <button onclick="logParticipation()">Log Participation</button>

            <div id="profResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Student Tab -->
        <div id="student" class="tab-content">
            <h2>Student Actions</h2>
            
            <div class="form-group">
                <label>Student ID:</label>
                <input type="text" id="studentId" placeholder="Enter student ID">
            </div>

            <h3>Check In</h3>
            <div class="form-group">
                <label>Lecture Code (4 digits):</label>
                <input type="text" id="lectureCode" placeholder="e.g., 3827" maxlength="4">
            </div>
            <button onclick="checkIn()">Check In</button>

            <h3>View Profile</h3>
            <button onclick="getProfile()">Get Profile</button>

            <div id="studentResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Questions Tab -->
        <div id="questions" class="tab-content">
            <h2>Question Management</h2>
            
            <div class="form-group">
                <label>Professor ID:</label>
                <input type="text" id="questionProfId" placeholder="Enter professor ID">
            </div>

            <h3>Create Question</h3>
            <div class="form-group">
                <label>Lecture ID:</label>
                <input type="text" id="questionLectureId" placeholder="Enter lecture ID">
            </div>
            <div class="form-group">
                <label>Mode:</label>
                <select id="questionMode">
                    <option value="ai_full">AI Full (AI generates everything)</option>
                    <option value="manual_full">Manual Full (You create everything)</option>
                    <option value="hybrid">Hybrid (You create question, AI generates answers)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Question Text (required for manual/hybrid):</label>
                <textarea id="questionText" rows="2" placeholder="Enter question text"></textarea>
            </div>
            <div class="form-group">
                <label>Option A (required for manual):</label>
                <input type="text" id="optionA" placeholder="Option A">
            </div>
            <div class="form-group">
                <label>Option B (required for manual):</label>
                <input type="text" id="optionB" placeholder="Option B">
            </div>
            <div class="form-group">
                <label>Option C (required for manual):</label>
                <input type="text" id="optionC" placeholder="Option C">
            </div>
            <div class="form-group">
                <label>Option D (required for manual):</label>
                <input type="text" id="optionD" placeholder="Option D">
            </div>
            <div class="form-group">
                <label>Correct Answer (required for manual):</label>
                <select id="correctAnswer">
                    <option value="a">A</option>
                    <option value="b">B</option>
                    <option value="c">C</option>
                    <option value="d">D</option>
                </select>
            </div>
            <button onclick="createQuestion()">Create Question</button>

            <h3>Trigger Question</h3>
            <div class="form-group">
                <label>Question ID:</label>
                <input type="text" id="triggerQuestionId" placeholder="Enter question ID">
            </div>
            <button onclick="triggerQuestion()">Trigger Question</button>

            <div id="questionResponse" class="response" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        async function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;
            
            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, role })
                });
                const data = await res.json();
                showResponse('authResponse', data, !res.ok);
                
                // Auto-fill the user ID in the appropriate tab
                if (res.ok && data.user_id) {
                    if (role === 'professor') {
                        document.getElementById('profId').value = data.user_id;
                    } else {
                        document.getElementById('studentId').value = data.user_id;
                    }
                }
            } catch (e) {
                showResponse('authResponse', { error: e.message }, true);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                showResponse('authResponse', data, !res.ok);
                
                // Auto-fill the user ID in the appropriate tab
                if (res.ok && data.user_id) {
                    if (data.role === 'professor') {
                        document.getElementById('profId').value = data.user_id;
                    } else {
                        document.getElementById('studentId').value = data.user_id;
                    }
                }
            } catch (e) {
                showResponse('authResponse', { error: e.message }, true);
            }
        }

        function showResponse(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.innerHTML = `
                <div class="status ${isError ? 'error' : 'success'}">
                    ${isError ? '‚ùå Error' : '‚úÖ Success'}
                </div>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }

        async function createClass() {
            const profId = document.getElementById('profId').value;
            const className = document.getElementById('className').value;
            try {
                const res = await fetch(`${API_URL}/classes?professor_id=${profId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: className })
                });
                const data = await res.json();
                showResponse('profResponse', data, !res.ok);
            } catch (e) {
                showResponse('profResponse', { error: e.message }, true);
            }
        }

        async function createLecture() {
            const classId = document.getElementById('createLectureClassId').value;
            try {
                const res = await fetch(`${API_URL}/lectures`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ class_id: classId })
                });
                const data = await res.json();
                showResponse('profResponse', data, !res.ok);
                
                // Auto-fill lecture ID if successful
                if (res.ok && data.lecture_id) {
                    document.getElementById('lectureId').value = data.lecture_id;
                    document.getElementById('createdLectureId').textContent = data.lecture_id;
                    document.getElementById('lectureIdDisplay').style.display = 'block';
                }
            } catch (e) {
                showResponse('profResponse', { error: e.message }, true);
            }
        }

        async function startLecture() {
            const lectureId = document.getElementById('lectureId').value;
            try {
                const res = await fetch(`${API_URL}/lectures/${lectureId}/start`, {
                    method: 'POST'
                });
                const data = await res.json();
                showResponse('profResponse', data, !res.ok);
            } catch (e) {
                showResponse('profResponse', { error: e.message }, true);
            }
        }

        async function endLecture() {
            const lectureId = document.getElementById('lectureId').value;
            try {
                const res = await fetch(`${API_URL}/lectures/${lectureId}/end`, {
                    method: 'POST'
                });
                const data = await res.json();
                showResponse('profResponse', data, !res.ok);
            } catch (e) {
                showResponse('profResponse', { error: e.message }, true);
            }
        }

        async function logParticipation() {
            const profId = document.getElementById('profId').value;
            const studentId = document.getElementById('participationStudentId').value;
            const lectureId = document.getElementById('participationLectureId').value;
            try {
                const res = await fetch(`${API_URL}/participation/log?professor_id=${profId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ student_id: studentId, lecture_id: lectureId })
                });
                const data = await res.json();
                showResponse('profResponse', data, !res.ok);
            } catch (e) {
                showResponse('profResponse', { error: e.message }, true);
            }
        }

        async function checkIn() {
            const studentId = document.getElementById('studentId').value;
            const lectureCode = document.getElementById('lectureCode').value;
            try {
                const res = await fetch(`${API_URL}/attendance/check-in?student_id=${studentId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lecture_code: lectureCode })
                });
                const data = await res.json();
                showResponse('studentResponse', data, !res.ok);
            } catch (e) {
                showResponse('studentResponse', { error: e.message }, true);
            }
        }

        async function getProfile() {
            const studentId = document.getElementById('studentId').value;
            try {
                const res = await fetch(`${API_URL}/students/${studentId}/profile`);
                const data = await res.json();
                showResponse('studentResponse', data, !res.ok);
            } catch (e) {
                showResponse('studentResponse', { error: e.message }, true);
            }
        }

        async function createQuestion() {
            const profId = document.getElementById('questionProfId').value;
            const lectureId = document.getElementById('questionLectureId').value;
            const mode = document.getElementById('questionMode').value;
            const questionText = document.getElementById('questionText').value;
            const optionA = document.getElementById('optionA').value;
            const optionB = document.getElementById('optionB').value;
            const optionC = document.getElementById('optionC').value;
            const optionD = document.getElementById('optionD').value;
            const correctAnswer = document.getElementById('correctAnswer').value;

            const payload = {
                lecture_id: lectureId,
                mode: mode
            };

            if (mode === 'manual_full') {
                payload.question_text = questionText;
                payload.option_a = optionA;
                payload.option_b = optionB;
                payload.option_c = optionC;
                payload.option_d = optionD;
                payload.correct_answer = correctAnswer;
            } else if (mode === 'hybrid') {
                payload.question_text = questionText;
            }

            try {
                const res = await fetch(`${API_URL}/questions?professor_id=${profId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                showResponse('questionResponse', data, !res.ok);
            } catch (e) {
                showResponse('questionResponse', { error: e.message }, true);
            }
        }

        async function triggerQuestion() {
            const questionId = document.getElementById('triggerQuestionId').value;
            try {
                const res = await fetch(`${API_URL}/questions/${questionId}/trigger`, {
                    method: 'POST'
                });
                const data = await res.json();
                showResponse('questionResponse', data, !res.ok);
            } catch (e) {
                showResponse('questionResponse', { error: e.message }, true);
            }
        }
    </script>
</body>
</html>

